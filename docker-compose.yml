version: "3.9"

networks:
  bllsoneshot-net:
    driver: bridge

services:
  mysql:
    image: mysql:8.4
    container_name: bllsoneshot-mysql
    restart: unless-stopped
    networks: [bllsoneshot-net]

  redis:
    image: redis:7-alpine
    container_name: bllsoneshot-redis
    restart: unless-stopped
    networks: [bllsoneshot-net]

  app:
    image: ${APP_IMAGE}
    container_name: bllsoneshot-app
    restart: unless-stopped
    env_file: [.env]
    networks: [bllsoneshot-net]
    ports:
      - "8080:8080"

  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: bllsoneshot-cloudflared
    restart: unless-stopped
    command: tunnel --no-autoupdate run
    environment:
      - TUNNEL_TOKEN=${CF_TUNNEL_TOKEN}
    networks: [bllsoneshot-net]
